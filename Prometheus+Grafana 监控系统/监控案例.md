## 监控 Linux 服务器
node_exporter
    使用文档 https://prometheus.io/docs/guides/node-exporter/
    列表 https://prometheus.io/docs/instrumenting/exporters/
将此程序部署在被监控的机器上并运行，信息通过 9100 端口暴漏出来

编辑监控端的 yml
```
  - job_name: 'node'
    file_sd_configs:
    - files: ['/usr/local/prometheus/test/node.yml']
      refresh_interval: 5s
```
node.xml
```
- targets:
  - 192.168.10.114:9100
```
## 监控 硬件
CPU 使用率的 PromSQL 语句
`100 - (irate(node_cpu_seconds_total{job="node",mode="idle"}[5m])* 100)`
`100 - avg(irate(node_cpu_seconds_total{mode="idle"}[5m])) by (instance) * 100`
内存使用率
`100-(node_memory_MemFree_bytes+node_memory_Cached_bytes+node_memory_Buffers_bytes)/node_memory_MemTotal_bytes`
硬盘使用率
`100-node_filesystem_free_bytes{mountpoint="/",fstype=~"ext4|xfs"} / node_filesystem_size_bytes{mountpoint="/",fstype=~"ext4|xfs"}*100`

## 监控系统服务状态
在被监控端启动 node_exporter 时加入参数
`nohup ./node_exporter --collector.systemd --collector.systemd.unit-whitelist="(sshd).service" &`

## 与 Grafana 集成
下载和安装 Grafana
运行 Grafana
配置 Prometheus 的数据源以及绘画图表

## 监控 Docker 服务器
cAdvisor    用于收集正在运行的容器资源使用和性能信息
https://github.com/google/cadvisor
安装好 Docker 后运行 cAdvisor
```
docker run \
  --volume=/:/rootfs:ro \
  --volume=/var/run:/var/run:ro \
  --volume=/sys:/sys:ro \
  --volume=/var/lib/docker/:/var/lib/docker:ro \
  --volume=/dev/disk/:/dev/disk:ro \
  --publish=8080:8080 \
  --detach=true \
  --name=cadvisor \
  --privileged \
  --device=/dev/kmsg \
  google/cadvisor:latest
```
访问 8080 端口就可以获取信息
在 prometheus.yml 添加 job
```
  - job_name: 'docker'
    static_configs:
    - targets: ['192.168.10.221:8080']
```

## 监控 MySQL 性能
mysql_exporter  用于收集MySQL性能信息
https://github.com/prometheus/mysqld_exporter